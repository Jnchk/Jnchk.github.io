<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Flask Simple Manual - KillMeBaby</title>
  <meta property="og:title" content="Flask Simple Manual - KillMeBaby" />
  <meta name="twitter:title" content="Flask Simple Manual - KillMeBaby" />
  <meta name="description" content="Flask is a microframework for Python based on Werkzeug, Jinja 2 and good intentions.">
  <meta property="og:description" content="Flask is a microframework for Python based on Werkzeug, Jinja 2 and good intentions.">
  <meta name="twitter:description" content="Flask is a microframework for Python based on Werkzeug, Jinja 2 and good intentions.">
  <meta name="author" content="Jnchk"/>
  <link rel='icon' type='image/x-icon' href="https://killmebaby.cc/img/favicon.ico" />
  <meta property="og:site_name" content="KillMeBaby" />
  <meta property="og:url" content="https://killmebaby.cc/posts/2018-12-5-flask-manual/" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.120.4">
  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/style-dark.css" media="all and (prefers-color-scheme: dark)" />

  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />

  <script src="/js/script.js"></script>
  <script src="/js/custom.js"></script>
  <script defer src="/js/fontawesome.js"></script>
</head>

<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="/">KillMeBaby</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-categories"><a href="/categories/" title="Categories">Categories</a></li>
      <li class="site-navi-item-tags"><a href="/tags/" title="Tags">Tags</a></li>
      <li class="site-navi-item-archives"><a href="/archives/" title="Archives">Archives</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      
      
      <h1 class="article-title">Flask Simple Manual</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>December 5, 2018</time></li>
        <li class="article-meta-categories">
          <a href="/categories/python/">
            <i class="fas fa-folder"></i>
            python
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/flask/">
            <i class="fas fa-tag"></i>
            flask
          </a>&nbsp;
        </li>
      </ul>
      
      <p><code>Flask</code> is a microframework for Python based on Werkzeug, Jinja 2 and good intentions.</p>
<h1 id="install">Install</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">virtualenv ~/.env/flask/ --python<span class="o">=</span>python2.7
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.env/flask/bin/activate
</span></span><span class="line"><span class="cl">pip install Flask
</span></span><span class="line"><span class="cl">pip install uWSGI  <span class="c1"># Be used for production development</span>
</span></span><span class="line"><span class="cl">pacman -S nginx
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="simple-example">Simple Example</h1>
<p>We need a simple example to test our deployment. It returns &lsquo;Hello World!&rsquo; when
client request &lsquo;/&rsquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">application</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@application.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Hello World!&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can test the code with the command below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">FLASK_APP</span><span class="o">=</span>hello.py flask run
</span></span><span class="line"><span class="cl"> * Serving Flask app <span class="s2">&#34;hello.py&#34;</span>
</span></span><span class="line"><span class="cl"> * Environment: production
</span></span><span class="line"><span class="cl">   WARNING: Do not use the development server in a production environment.
</span></span><span class="line"><span class="cl">   Use a production WSGI server instead.
</span></span><span class="line"><span class="cl"> * Debug mode: off
</span></span><span class="line"><span class="cl"> * Running on http://127.0.0.1:5000/ <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And test with <code>curl</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl localhost:5000
</span></span><span class="line"><span class="cl">Hello World!
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="production-deployment">Production Deployment</h1>
<h2 id="uwsgi">uWSGI</h2>
<p>Flaskâ€™s built-in server is not suitable for production. We can deploy <code>Flask</code>
in multiple ways. For more details, check
<a href="http://flask.pocoo.org/docs/1.0/deploying/#deployment">here</a>.</p>
<p>We will use <code>uWSGI</code>. You can start multiple servers with commands below. They can
listen to a http port or a unix domain socket.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">uwsgi --http :8080 --manage-script-name --mount /hello<span class="o">=</span>hello:application
</span></span><span class="line"><span class="cl">uwsgi --socket ~/Documents/flask/hello.sock --manage-script-name --mount /hello<span class="o">=</span>hello:application --chmod-socket<span class="o">=</span><span class="m">664</span>
</span></span><span class="line"><span class="cl">uwsgi --socket ~/Documents/flask/hello.sock --manage-script-name --mount /hello<span class="o">=</span>hello:application --workers <span class="m">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>All the <code>uwsgi</code> command arguments can be set in a configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="p">;</span> wsgi_hello.ini
</span></span><span class="line"><span class="cl"><span class="o">[</span>uwsgi<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">workdir</span> <span class="o">=</span> /tmp/flask
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;</span> socket and http port
</span></span><span class="line"><span class="cl"><span class="nv">socket</span> <span class="o">=</span> /tmp/flask/hello.sock
</span></span><span class="line"><span class="cl">chmod-socket <span class="o">=</span> <span class="m">664</span>
</span></span><span class="line"><span class="cl"><span class="p">;</span><span class="nv">http</span> <span class="o">=</span> 127.0.0.1:8080
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;</span> <span class="nb">enable</span> the stats server on port <span class="m">9191</span>
</span></span><span class="line"><span class="cl"><span class="nv">stats</span> <span class="o">=</span> 127.0.0.1:9191
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;</span> master and process setting
</span></span><span class="line"><span class="cl"><span class="nv">master</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">processes</span> <span class="o">=</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="nv">threads</span> <span class="o">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;</span> <span class="nb">set</span> mountpoints
</span></span><span class="line"><span class="cl"><span class="nv">plugin</span> <span class="o">=</span> python
</span></span><span class="line"><span class="cl"><span class="nv">mount</span> <span class="o">=</span> /hello<span class="o">=</span>hello:application
</span></span><span class="line"><span class="cl">manage-script-name <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;</span>wsgi-file <span class="o">=</span> hello.py
</span></span><span class="line"><span class="cl"><span class="p">;</span><span class="nv">callable</span> <span class="o">=</span> application
</span></span></code></pre></td></tr></table>
</div>
</div><p>Spawn the server with command below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">uwsgi --ini wsgi_hello.ini
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="nginx">Nginx</h2>
<p><code>Nginx</code> will be the front server of <code>uWSGI</code>. Here&rsquo;s the config file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat /etc/nginx/conf.d/flask.conf
</span></span><span class="line"><span class="cl">upstream flask <span class="o">{</span>
</span></span><span class="line"><span class="cl">    server unix:///tmp/flask/hello.sock<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#server 172.17.0.1:8080;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">    listen 8080<span class="p">;</span>
</span></span><span class="line"><span class="cl">    server_name flask_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location /hello <span class="o">{</span>
</span></span><span class="line"><span class="cl">        include uwsgi_params<span class="p">;</span>
</span></span><span class="line"><span class="cl">        uwsgi_pass flask<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#proxy_pass http://flask;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl restart nginx
</span></span></code></pre></td></tr></table>
</div>
</div><p>Test with 8080/tcp.</p>
    </article>

    


    <ul class="pager article-pager">
      <li class="pager-newer pager-noitem">&lt; Newer</li>
      <li class="pager-older">
        <a href="/posts/2018-10-27-how-to-deploy-local-docker-registry/" data-toggle="tooltip" data-placement="top" title="How to Deploy Local Docker Registry">Older &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer">
  <div class="copyright">&copy; Copyright 2018-2023 Jnchk. Protected by <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.en>CC BY-NC-SA 4.0</a>.</div>
  <ul class="site-footer-items">
  </ul>
  <div class="powerdby">
    Powered by <a href="https://gohugo.io/">Hugo</a> and <a href="https://github.com/taikii/whiteplain">Whiteplain</a>
  </div>
</div>


</body>
</html>
